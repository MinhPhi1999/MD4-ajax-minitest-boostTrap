<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
            crossorigin="anonymous"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light" >
    <a class="navbar-brand" onclick="showList()">List Product</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" onclick="sortByPrice()">Sắp xếp theo giá <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="getTop4()">Top 4 </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showAddForm()">Thêm mới</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showFormBetween()">Tìm theo khoảng</a>
            </li>
        </ul>
        <div class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Name" id="search">
            <button class="btn btn-outline-success my-2 my-sm-0" onclick="search()">Search</button>
        </div>
    </div>
</nav>
<!--<button onclick="showList()">Hiện thị list Product</button>-->
<!--<button onclick="sortByPrice()">Sắp xếp theo giá</button>-->
<!--<button onclick="getTop4()">Top 4 mới nhất</button>-->
<div id="formCreate"></div>
<!--<div>-->
<!--    <input type="text" id="from" placeholder="from">-->
<!--    <input type="text" id="to" placeholder="to">-->
<!--    <button onclick="between()">Tìm giữa khoảng</button>-->
<!--</div>-->

<!--<button onclick="showAddForm()">Thêm Product</button>-->
<!--<div id="formCreate"></div>-->
<!--<div>-->
<!--    <input placeholder="Tên" type="text" id="search">-->
<!--    <button onclick="search()">Tìm theo tên</button>-->
<!--</div>-->
<div>
    <table class="table table-striped table-dark" id="display" style="text-align: center">
    </table>
<!--    <table border="1px" >-->
<!--    </table>-->
</div>
<!--footer-->
<!-- Footer -->
<footer class="text-center text-lg-start bg-light text-muted">
    <!-- Section: Social media -->
    <section
            class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom"
    >
        <!-- Left -->
        <div class="me-5 d-none d-lg-block">
            <span>Get connected with us on social networks:</span>
        </div>
        <!-- Left -->

        <!-- Right -->
        <div>
            <a href="" class="me-4 text-reset">
                <i class="fab fa-facebook-f"></i>
            </a>
            <a href="" class="me-4 text-reset">
                <i class="fab fa-twitter"></i>
            </a>
            <a href="" class="me-4 text-reset">
                <i class="fab fa-google"></i>
            </a>
            <a href="" class="me-4 text-reset">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="" class="me-4 text-reset">
                <i class="fab fa-linkedin"></i>
            </a>
            <a href="" class="me-4 text-reset">
                <i class="fab fa-github"></i>
            </a>
        </div>
        <!-- Right -->
    </section>
    <!-- Section: Social media -->

    <!-- Section: Links  -->
    <section class="">
        <div class="container text-center text-md-start mt-5">
            <!-- Grid row -->
            <div class="row mt-3">
                <!-- Grid column -->
                <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
                    <!-- Content -->
                    <h6 class="text-uppercase fw-bold mb-4">
                        <i class="fas fa-gem me-3"></i>Company name
                    </h6>
                    <p>
                        Here you can use rows and columns to organize your footer content. Lorem ipsum
                        dolor sit amet, consectetur adipisicing elit.
                    </p>
                </div>
                <!-- Grid column -->

                <!-- Grid column -->
                <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
                    <!-- Links -->
                    <h6 class="text-uppercase fw-bold mb-4">
                        Products
                    </h6>
                    <p>
                        <a href="#!" class="text-reset">Angular</a>
                    </p>
                    <p>
                        <a href="#!" class="text-reset">React</a>
                    </p>
                    <p>
                        <a href="#!" class="text-reset">Vue</a>
                    </p>
                    <p>
                        <a href="#!" class="text-reset">Laravel</a>
                    </p>
                </div>
                <!-- Grid column -->

                <!-- Grid column -->
                <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
                    <!-- Links -->
                    <h6 class="text-uppercase fw-bold mb-4">
                        Useful links
                    </h6>
                    <p>
                        <a href="#!" class="text-reset">Pricing</a>
                    </p>
                    <p>
                        <a href="#!" class="text-reset">Settings</a>
                    </p>
                    <p>
                        <a href="#!" class="text-reset">Orders</a>
                    </p>
                    <p>
                        <a href="#!" class="text-reset">Help</a>
                    </p>
                </div>
                <!-- Grid column -->

                <!-- Grid column -->
                <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
                    <!-- Links -->
                    <h6 class="text-uppercase fw-bold mb-4">
                        Contact
                    </h6>
                    <p><i class="fas fa-home me-3"></i> New York, NY 10012, US</p>
                    <p>
                        <i class="fas fa-envelope me-3"></i>
                        info@example.com
                    </p>
                    <p><i class="fas fa-phone me-3"></i> + 01 234 567 88</p>
                    <p><i class="fas fa-print me-3"></i> + 01 234 567 89</p>
                </div>
                <!-- Grid column -->
            </div>
            <!-- Grid row -->
        </div>
    </section>
    <!-- Section: Links  -->

    <!-- Copyright -->
    <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
        © 2021 Copyright:
        <a class="text-reset fw-bold" href="https://mdbootstrap.com/">MDBootstrap.com</a>
    </div>
    <!-- Copyright -->
</footer>
<!-- Footer -->
</body>
<script>
    // in ra sản phẩm
    //     function display(data) {
    //         let str = ''
    //         for (let i = 0; i < data.length; i++) {
    //             str += `<tr>
    //                     <td>${data[i].name}</td>
    //                     <td>${data[i].price}</td>
    //                     <td>${data[i].category.name}</td>
    //                     <td><button onclick="deleteProduct(${data[i].id})">Delete</button></td>
    //                     <td><button onclick="showEditForm(${data[i].id})">Edit</button></td>
    //                 </tr>`
    //         }
    //         document.getElementById('display').innerHTML = str;
    //     }
    function display(data) {
        let str = '<tr>\n' +
            '        <td>Name</td>\n' +
            '        <td>Price</td>\n' +
            '        <td>Category</td>\n' +
            '        <td colspan="2">Action</td>\n' +
            '    </tr>'

        for (let i = 0; i < data.length; i++) {
            str += `<tr>
                <td>${data[i].name}</td>
                <td>${data[i].price}</td>
                <td>${data[i].category.name}</td>
                <td><button onclick="deleteProduct(${data[i].id})" type="button" class="btn btn-success" style="width: 100px">Delete</button></td>
                <td><button onclick="showEditForm(${data[i].id})" type="button" class="btn btn-success" style="width: 100px">Edit</button></td>
            </tr>`
        }
        document.getElementById('display').innerHTML = str;
    }


    // hiển thị danh sách
    function showList() {
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: 'GET',
            url: 'http://localhost:8080/api/products',
            success: function (data) {
                display(data)
            },
            error: "loi"
        })

    }

    // xóa
    function deleteProduct(id) {
        $.ajax({
            type: 'DELETE',
            url: 'http://localhost:8080/api/products/delete/' + id,
            success: function (data) {
                showList(data)
            }
        })
    }

    // show form thêm sp
    function showAddForm() {
        let str1 = '';
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/api/categories',
            success: function (data) {
                for (let i = 0; i < data.length; i++) {
                    str1 += "    <option id='" + data[i].id + "' value='" + data[i].id + "'>" + data[i].name + "</option>\n"
                }
                let str = "<h3>Tạo mới </h3>"+
                    "    <input placeholder='Name' type=\"text\" id=\"name\">\n" +
                    "    <input placeholder='Price' type=\"text\" id=\"price\">\n" +
                    "<select id=\"category\">" + str1 + "</select>" +
                    "    <button onclick='save()'>Thêm</button>"
                document.getElementById("formCreate").innerHTML = str;
            },
            error: function (error) {
                console.log(error);
            }
        })
    }
    // form between
    function showFormBetween() {
        // let str= '';
        let str ='<h3>Nhập khoảng:</h3>'+
            '<input type=\"text\" id=\"from\" placeholder="from">'+
            '<input type=\"text\" id=\"to\" placeholder="to">'+
            '    <button onclick="between()">Tìm</button>'
        document.getElementById("formCreate").innerHTML = str;
    }


// form edit
    function showEditForm(id) {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/products/" + id,
            success: function (data) {
                let str = ""
                let str1 = ""
                $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/api/categories/",
                    success: function (data1) {
                        console.log(data1)
                        for (let i = 0; i < data1.length; i++) {
                            str1 += "<option id='" + data1[i].id + "' value='" + data1[i].id + "'>" + data1[i].name + "</option>\n"
                        }
                        // dùng dấu `` khi trong cộng chuỗi có sd $
                        // còn "", '' khi cộng chuỗi chỉ có chuỗi

                        // str = `<h3>Chỉnh sửa</h3>` +
                        //     `    Name<input value="${data.name}" type=\"text\" id=\"name\">\n` +
                        //     `    Price<input type=\"text\" id=\"price\" value="${data.price}">\n` +
                        //     "    <select id=\"category\">" + str1 + "</select>" +
                        //     `    <button onclick='update(${data.id})'>Edit</button>`
                        // cách 2: a Hùng
                        str = "<h3>Sửa Sản Phẩm</h3>" +
                            "    <input type=\"text\" id=\"name\" value= \'" + data.name + "'\>\n" +
                            "    <input type=\"text\" id=\"price\" value=\'" + data.price + "'\>\n" +
                            "<select id=\"category\">" + str1 + "</select>" +
                            "    <button onclick='update(" + id + ")'>Sửa</button>"
                        document.getElementById("formCreate").innerHTML = str;
                    }
                })
            }, error: function (error) {
                console.log(error);
            }
        })
    }

    // lưu thêm mới
    function save() {
        // lấy value từ các thẻ input trong form tạo mới
        let name = document.getElementById("name").value;
        let price = document.getElementById("price").value;
        let categoryId = document.getElementById("category").value;
        // khởi tạo đối tượng gồm các trường name, price, cate
        let product = {
            name: name,
            price: price,
            category: {
                id: categoryId
            }
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
            type: 'POST',
            url: 'http://localhost:8080/api/products',
            // nhận đối tượng và chuyển sang dạng JSON
            data: JSON.stringify(product),
            success: function (data) {
                // hiển thị list mới
                showList()
            },
            error: function (error) {
                console.log(error)
            }
        })
    }

    // chỉnh sửa
    function update(id) {
        // lấy value từ các thẻ input trong form tạo mới
        let name = document.getElementById("name").value;
        let price = document.getElementById("price").value;
        let categoryId = document.getElementById("category").value;
        // khởi tạo đối tượng gồm các trường name, price, cate
        let product = {
            id: id,
            name: name,
            price: price,
            category: {
                id: categoryId
            }
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
            type: 'PUT',
            url: 'http://localhost:8080/api/products/' + id,
            data: JSON.stringify(product),
            success: function (data) {
                showList()
            },
            error: function (error) {
                console.log(error)
            }
        })
    }

    // search
    function search() {
        let name = document.getElementById("search").value;
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: 'GET',
            url: 'http://localhost:8080/api/products/search?name=' + name,
            success: function (data) {
                display(data)
            }
        })
    }

    // sắp xếp theo giá
    function sortByPrice() {
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/api/products/sortByPrice',
            success: function (data) {
                display(data)
            }
        })
    }

    // hiện thị top 4 mới nhất
    function getTop4() {
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/api/products/top',
            success: function (data) {
                display(data)
            }
        })
    }

    // lấy giữa khoảng
    function between() {
        let from = document.getElementById('from').value;
        let to = document.getElementById('to').value;
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/api/products/between?from=' + from + '&to=' + to,
            success: function (data) {
                display(data)
            }
        })
    }
</script>
</html>